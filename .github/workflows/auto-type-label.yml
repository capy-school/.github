name: Auto add Type label from title

on:
  issues:
    types: [opened, edited]

permissions:
  issues: write
  contents: read

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Ensure Type label based on title
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const title = context.payload.issue.title || "";
            const map = [
              { key: 'Type: Bug', patterns: ['[ðŸ›', 'Type: Bug'] },
              { key: 'Type: Feature', patterns: ['[âœ¨', 'Type: Feature'] },
              { key: 'Type: Tech Task', patterns: ['[ðŸ› ï¸', 'Type: Tech Task', 'Type: Tech'] },
              { key: 'Type: Research', patterns: ['[ðŸ”¬', 'Type: Research'] },
              { key: 'Type: Question', patterns: ['[â“', 'Type: Question'] },
              { key: 'Type: Documentation', patterns: ['[ðŸ“', 'Type: Documentation'] },
              { key: 'Type: Epic', patterns: ['[ðŸ—ºï¸', 'Type: Epic'] }
            ];
            const found = map.find(m => m.patterns.some(p => title.includes(p)));
            if (!found) return;
            const labels = context.payload.issue.labels.map(l => l.name);
            if (labels.includes(found.key)) return;
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue.number,
              labels: [found.key]
            });